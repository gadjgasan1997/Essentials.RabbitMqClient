<?xml version="1.0" encoding="utf-8"?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
	  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	  autoReload="true"
	  internalLogLevel="Error"
	  internalLogIncludeTimestamp="true"
	  internalLogToConsole="true"
	  internalLogToConsoleError="true"
	  xsi:schemaLocation="http://www.nlog-project.org/schemas/NLog.xsd https://nlog-project.org/schemas/NLog.xsd">

	<!-- Переменные -->
	<variable name="custom_date" value="${date:format=yyyy-MM-dd HH\:mm\:ss}" />
	<variable name="microsoftLevel" value="${when:when=level==LogLevel.Error:inner=fail}${when:when=level==LogLevel.Fatal:inner=crit}${when:when=level==LogLevel.Warn:inner=warn}${when:when=level==LogLevel.Info:inner=info}${when:when=level==LogLevel.Debug:inner=dbug}${when:when=level==LogLevel.Trace:inner=trce}" />

	<variable name="exception_layout" value="${onexception:inner=EXCEPTION: ${newline}${exception:format=tostring}}" />
	<variable name="logLayout" value="
		${newline}[${custom_date}] ${microsoftLevel}: ${logger}
		${newline}RabbitMessageId: ${scopeproperty:item=rabbit_message_id}
		${newline}${message}
		${exception_layout}" />

	<!-- Таргеты -->
	<targets async="true">
		<target name="coloredConsole"
				xsi:type="ColoredConsole"
				useDefaultRowHighlightingRules="false"
				layout="${logLayout}">
			<highlight-word foregroundColor="DarkGreen" regex="info" ignoreCase="false" wholeWords="true" />
			<highlight-word foregroundColor="Yellow" regex="warn" ignoreCase="false" wholeWords="true" />
			<highlight-word foregroundColor="Black" backgroundColor="Red" regex="fail" ignoreCase="false" wholeWords="true" />
			<highlight-word foregroundColor="White" backgroundColor="Red" regex="crit" ignoreCase="false" wholeWords="true" />
		</target>
	</targets>

	<!-- Логгеры -->
	<rules>
		<logger name="System.*" maxlevel="Warn" final="true" />
		<logger name="Microsoft.*" maxlevel="Warn" final="true" />
		<logger name="App.Metrics.*" maxlevel="Warn" final="true" />
		
		<logger name="Essentials.RabbtMq.Client.Main"
				xsi:finalMinlevel="${environment:Loggers__Queue__Main__Level}"
				writeTo="coloredConsole"
				final="true" />
		<logger name="Essentials.RabbtMq.Client.EventsPublisher"
				xsi:finalMinlevel="${environment:Loggers__Queue__EventsPublisher__Level}"
				writeTo="coloredConsole"
				final="true" />
		<logger name="Essentials.RabbtMq.Client.EventsSubscriber"
				xsi:finalMinlevel="${environment:Loggers__Queue__EventsSubscriber__Level}"
				writeTo="coloredConsole"
				final="true" />
		<logger name="Essentials.RabbitMqClient.PublishMessageBehavior.esb_ha.amq.direct.*"
				xsi:finalMinlevel="${environment:Loggers__Queue__LoggingMessagePublisherBehavior__Level}"
				writeTo="coloredConsole"
				final="true" />
		<logger name="Essentials.RabbitMqClient.HandleMessageBehavior.esb_ha.*"
				xsi:finalMinlevel="${environment:Loggers__Queue__LoggingMessageHandlerBehavior__Level}"
				writeTo="coloredConsole"
				final="true" />
		
		<logger name="*"
				xsi:minlevel="Info"
				writeTo="coloredConsole"
				final="true" />
	</rules>
</nlog>